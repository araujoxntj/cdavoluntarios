<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Perfil ‚Ä¢ Cidade Alta</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../css/global.css">
<style>
/* Mant√©m todo o seu CSS original */
.profile-wrap{ max-width:1100px; margin:40px auto; padding:0 20px; }
.profile-card{ display:grid; grid-template-columns:260px 1fr; gap:24px; }
.photo-box{ background:#151515; border-radius:18px; padding:20px; text-align:center; }
.photo-box img{ width:140px; height:140px; border-radius:50%; object-fit:cover; border:3px solid #ffbb00; }
.photo-box label{ display:inline-block; margin-top:12px; font-size:.75rem; background:#ffbb00; color:#000; padding:6px 14px; border-radius:10px; cursor:pointer; font-weight:700; }
.photo-box input{ display:none; }
.info-box{ background:#151515; border-radius:18px; padding:24px; }
.badge{ display:inline-block; background:#ffbb00; color:#000; padding:4px 12px; border-radius:999px; font-size:.7rem; font-weight:700; margin-bottom:14px; }
.grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:16px; margin-top:20px; }
.item{ background:#101010; padding:16px; border-radius:14px; border:1px solid #222; }
.item span{ font-size:.7rem; opacity:.6; }
.item strong{ display:block; margin-top:6px; }
.actions{ margin-top:26px; display:flex; gap:10px; flex-wrap:wrap; }
.action{ background:#1a1a1a; padding:10px 16px; border-radius:12px; font-size:.8rem; cursor:pointer; transition:0.2s; }
.action:hover{ background:#ffbb00; color:#000; }
</style>
</head>
<body onload="initProfile()">

<header class="top">
  <h1>Meu Perfil</h1>
  <button class="btn-small" onclick="go('dashboard.html')">‚Üê Dashboard</button>
</header>

<div class="profile-wrap">
  <div class="profile-card">

    <!-- FOTO -->
    <div class="photo-box">
      <img id="foto" src="https://via.placeholder.com/150">
      <input type="file" id="upload">
      <label for="upload">Alterar foto</label>
    </div>

    <!-- INFO -->
    <div class="info-box">
      <h2 id="nome"></h2>
      <div class="badge" id="cargo"></div>

      <div class="grid">
        <div class="item"><span>Email</span><strong id="email"></strong></div>
        <div class="item"><span>Fun√ß√£o</span><strong id="funcao"></strong></div>
        <div class="item"><span>Tempo de equipe</span><strong id="tempo">‚Äî</strong></div>
      </div>

      <div class="actions">
        <div class="action" onclick="go('../dashboard/feedback.html')">Feedback</div>
        <div class="action" onclick="go('../dashboard/registro.html')">Registrar</div>
        <div class="action" onclick="logout()">Sair</div>
      </div>
    </div>

  </div>
</div>

<script>
// üîπ Cache leve
const usuariosCache = JSON.parse(localStorage.getItem('usuarios')) || [];
const fotosCache = JSON.parse(localStorage.getItem('fotos') || '{}');
const userEmail = localStorage.getItem('email');
const user = usuariosCache.find(u => u.email === userEmail) || {};

// üîπ DOM
const nomeEl = document.getElementById('nome');
const cargoEl = document.getElementById('cargo');
const emailEl = document.getElementById('email');
const funcaoEl = document.getElementById('funcao');
const tempoEl = document.getElementById('tempo');
const fotoEl = document.getElementById('foto');
const uploadEl = document.getElementById('upload');

function initProfile(){
  checkAuth(); 
  renderProfile();
}

function renderProfile(){
  nomeEl.innerText = user.nome || '‚Äî';
  cargoEl.innerText = user.role || '‚Äî';
  emailEl.innerText = user.email || '‚Äî';
  funcaoEl.innerText = user.funcao || '‚Äî';
  tempoEl.innerText = 'calculando...';

  // Foto async
  requestAnimationFrame(()=>{
    if(fotosCache[userEmail]) fotoEl.src = fotosCache[userEmail];
  });

  // Tempo de equipe async
  setTimeout(()=>{
    const inicio = user.inicio || Date.now();
    const dias = Math.floor((Date.now() - inicio) / 86400000);
    tempoEl.innerText = dias + ' dias';
  }, 10);
}

// Upload de foto
uploadEl.onchange = e =>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = ()=>{
    fotosCache[userEmail] = reader.result; 
    localStorage.setItem('fotos', JSON.stringify(fotosCache));
    fotoEl.src = reader.result;
  }
  reader.readAsDataURL(file);
}

function go(p){ location.href=p; }
</script>

</body>
</html>
