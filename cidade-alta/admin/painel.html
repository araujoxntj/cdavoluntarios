<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel administrativo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;700&display=swap" rel="stylesheet">
<link rel="icon" href="https://cidadealta.gg/favicon.svg" type="image/svg+xml">
<style>
body{ margin:0; font-family:'Comfortaa',sans-serif; background:#0b0b0b; color:#fff; }
header{ background:#121212; padding:18px 30px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #222; }
header h1{ font-size:1.1rem; }
header a{ color:#ffbb00; text-decoration:none; font-weight:700; font-size:.9rem; }
.container{ max-width:1000px; margin:60px auto; padding:0 20px; }
h2{ margin-bottom:30px; font-size:1.2rem; }
.grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:20px; }
.card{ background:#151515; padding:22px; border-radius:16px; cursor:pointer; transition:.3s; border:1px solid #222; }
.card:hover{ transform:translateY(-5px); box-shadow:0 0 25px rgba(255,187,0,.15); }
.card h3{ margin-bottom:8px; font-size:1rem; }
.card p{ font-size:.85rem; opacity:.75; }

/* MODAIS */
.modal{
  display:none;
  position:fixed;
  top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,.7);
  justify-content:center;
  align-items:center;
}
.modal-content{
  background:#151515;
  padding:24px;
  border-radius:16px;
  width:320px;
}
.modal-content h3{ margin-bottom:14px; }
.modal-content label{ display:block; margin:8px 0 4px; font-size:.85rem; }
.modal-content input, .modal-content select{
  width:100%;
  padding:6px 10px;
  border-radius:8px;
  border:1px solid #333;
  background:#111;
  color:#fff;
  margin-bottom:12px;
}
.modal-content button{
  padding:8px 12px;
  border:none;
  border-radius:8px;
  background:#ffbb00;
  color:#000;
  font-weight:700;
  cursor:pointer;
  width:100%;
}
.modal-content select[multiple]{ height:140px; overflow-y:auto; padding:6px 10px; }

#permissoesCargo, #permissoesEditarCargo{
  display:flex; flex-direction:column; gap:6px; max-height:180px; overflow-y:auto;
}
.checkbox-item{
  display:flex; justify-content:space-between; align-items:center; padding:3px 0; font-size:.85rem; cursor:pointer;
}
.checkbox-item span{ flex-grow:1; }
.checkbox-item input[type="checkbox"]{ margin:0; width:18px; height:18px; cursor:pointer; }
</style>
</head>
<body>

<header>
  <h1></h1>
  <a href="../dashboard/perfil.html">‚Üê Voltar ao Perfil</a>
</header>

<div class="container">
  <h2>Gerenciamento</h2>
  <div class="grid">
    <div class="card" onclick="location.href='usuarios.html'">
      <h3>üë• Usu√°rios</h3>
      <p>Gerenciar contas, cargos e fun√ß√µes</p>
    </div>
    <div class="card" onclick="location.href='voluntarios.html'">
      <h3>ü§ù Volunt√°rios</h3>
      <p>Aprova√ß√£o e reprova√ß√£o</p>
    </div>
    <div class="card" onclick="location.href='feedbacks.html'">
      <h3>üí¨ Feedbacks</h3>
      <p>Visualizar feedbacks enviados</p>
    </div>
    <div class="card" onclick="location.href='situacoes.html'">
      <h3>üìÇ Situa√ß√µes</h3>
      <p>Ver situa√ß√µes criadas</p>
    </div>
    <div class="card" onclick="location.href='vip.html'">
      <h3>üí† VIP</h3>
      <p>Gerir VIP</p>
    </div>
    <div class="card" onclick="location.href='indicacoes.html'">
      <h3>üèÖ Indica√ß√µes</h3>
      <p>Ver indica√ß√µes realizadas</p>
    </div>
    <div class="card" onclick="abrirModalCargo()">
      <h3>‚ûï Criar Cargo</h3>
      <p>Adicionar cargos e definir permiss√µes</p>
    </div>
    <div class="card" onclick="abrirModalEditarCargo()">
      <h3>‚úèÔ∏è Editar Cargo</h3>
      <p>Modificar permiss√µes de cargos existentes</p>
    </div>
  </div>
</div>

<!-- MODAL CRIAR CARGO -->
<div id="modalCargo" class="modal">
  <div class="modal-content">
    <h3>Criar Novo Cargo</h3>
    <label for="nomeCargo">Nome do cargo</label>
    <input type="text" id="nomeCargo" placeholder="Ex: Gerente">
    <label>Permiss√µes</label>
    <div id="permissoesCargo">
      <div class="checkbox-item"><span>Gerenciar Usu√°rios</span><input type="checkbox" value="usuarios"></div>
      <div class="checkbox-item"><span>Acessar Feedbacks</span><input type="checkbox" value="feedbacks"></div>
      <div class="checkbox-item"><span>Acessar Situa√ß√µes</span><input type="checkbox" value="situacoes"></div>
      <div class="checkbox-item"><span>Acessar Indica√ß√µes</span><input type="checkbox" value="indicacoes"></div>
      <div class="checkbox-item"><span>Gerenciar Volunt√°rios</span><input type="checkbox" value="voluntarios"></div>
      <div class="checkbox-item"><span>Configura√ß√µes</span><input type="checkbox" value="configuracoes"></div>
      <div class="checkbox-item"><span>Acesso ao Painel Admin</span><input type="checkbox" value="admin"></div>
    </div>
    <button onclick="criarCargo()">Criar Cargo</button>
  </div>
</div>

<!-- MODAL EDITAR CARGO -->
<div id="modalEditarCargo" class="modal">
  <div class="modal-content">
    <h3>Editar Cargo</h3>
    <label for="selectCargoEditar">Selecionar Cargo</label>
    <select id="selectCargoEditar" onchange="carregarPermissoes()"></select>
    <label>Permiss√µes</label>
    <div id="permissoesEditarCargo">
      <div class="checkbox-item"><span>Gerenciar Usu√°rios</span><input type="checkbox" value="usuarios"></div>
      <div class="checkbox-item"><span>Acessar Feedbacks</span><input type="checkbox" value="feedbacks"></div>
      <div class="checkbox-item"><span>Acessar Situa√ß√µes</span><input type="checkbox" value="situacoes"></div>
      <div class="checkbox-item"><span>Acessar Indica√ß√µes</span><input type="checkbox" value="indicacoes"></div>
      <div class="checkbox-item"><span>Gerenciar Volunt√°rios</span><input type="checkbox" value="voluntarios"></div>
      <div class="checkbox-item"><span>Configura√ß√µes</span><input type="checkbox" value="configuracoes"></div>
      <div class="checkbox-item"><span>Acesso ao Painel Admin</span><input type="checkbox" value="admin"></div>
    </div>
    <button onclick="salvarEdicaoCargo()">Salvar Altera√ß√µes</button>
  </div>
</div>

<script>
// üîê Verifica√ß√£o de acesso
const role = localStorage.getItem('role');
const email = localStorage.getItem('email');
const emailsAdmin = ["znxksamp@gmail.com"];
if(!['CM','Leader'].includes(role) && !emailsAdmin.includes(email)){
  alert('Acesso negado: voc√™ n√£o tem permiss√µes suficientes.');
  location.href='../dashboard/perfil.html';
}

// MODAIS
const modalCriar = document.getElementById('modalCargo');
const modalEditar = document.getElementById('modalEditarCargo');
function abrirModalCargo(){ modalCriar.style.display='flex'; }
function abrirModalEditarCargo(){ modalEditar.style.display='flex'; atualizarSelectEditar(); }
window.onclick = e => { 
  if(e.target==modalCriar) modalCriar.style.display='none'; 
  if(e.target==modalEditar) modalEditar.style.display='none'; 
}

// CRIAR CARGO
function criarCargo(){
  const nome = document.getElementById('nomeCargo').value.trim();
  const permissoes = Array.from(document.querySelectorAll('#permissoesCargo input[type=checkbox]:checked')).map(cb=>cb.value);
  if(!nome || permissoes.length===0){ alert('Preencha o nome e selecione pelo menos uma permiss√£o'); return; }

  let cargos = JSON.parse(localStorage.getItem('cargos')) || [];
  cargos.push({nome, permissoes});
  localStorage.setItem('cargos', JSON.stringify(cargos));
  alert(`Cargo "${nome}" criado com sucesso!`);
  
  document.getElementById('nomeCargo').value='';
  document.querySelectorAll('#permissoesCargo input[type=checkbox]').forEach(cb=>cb.checked=false);
  modalCriar.style.display='none';

  window.dispatchEvent(new Event('cargosAtualizados'));
}

// EDITAR CARGO
function atualizarSelectEditar(){
  const cargosSalvos = JSON.parse(localStorage.getItem('cargos')) || [];
  const nomesSalvos = cargosSalvos.map(c=>c.nome);

  // Pegar cargos de usu√°rios existentes
  const usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
  const cargosUsuarios = usuarios.map(u=>u.role).filter(Boolean);

  // Cargos padr√£o (opcional)
  const cargosPadrao = ['User','Moderador','CM','Leader'];

  // Combina todos sem duplicatas
  const todosCargos = Array.from(new Set([...nomesSalvos, ...cargosUsuarios, ...cargosPadrao]));

  const select = document.getElementById('selectCargoEditar');
  select.innerHTML = todosCargos.map(c=>`<option value="${c}">${c}</option>`).join('');
  
  carregarPermissoes();
}

function carregarPermissoes(){
  const cargosSalvos = JSON.parse(localStorage.getItem('cargos')) || [];
  const select = document.getElementById('selectCargoEditar');
  let cargoAtual = cargosSalvos.find(c => c.nome === select.value);

  // Se n√£o existir, cria tempor√°rio com permiss√µes vazias
  if(!cargoAtual){
    cargoAtual = { nome: select.value, permissoes: [] };
  }

  document.querySelectorAll('#permissoesEditarCargo input[type=checkbox]')
          .forEach(cb => cb.checked = cargoAtual.permissoes.includes(cb.value));
}

function salvarEdicaoCargo(){
  const cargosSalvos = JSON.parse(localStorage.getItem('cargos')) || [];
  const select = document.getElementById('selectCargoEditar');
  const index = cargosSalvos.findIndex(c => c.nome === select.value);

  const novasPerms = Array.from(document.querySelectorAll('#permissoesEditarCargo input[type=checkbox]:checked'))
                           .map(cb => cb.value);
  if(novasPerms.length===0) return alert('Selecione pelo menos uma permiss√£o');

  if(index !== -1){
    cargosSalvos[index].permissoes = novasPerms;
  } else {
    cargosSalvos.push({ nome: select.value, permissoes: novasPerms });
  }

  localStorage.setItem('cargos', JSON.stringify(cargosSalvos));
  alert(`Cargo "${select.value}" atualizado com sucesso!`);
  window.dispatchEvent(new Event('cargosAtualizados'));
}
</script>

</body>
</html>
