<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Registro de Horas Voluntários</title>
<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;700&display=swap" rel="stylesheet">
<style>
body { margin:0; font-family:'Comfortaa',sans-serif; background:#111; color:#fff; padding:20px; }
h1 { text-align:center; margin-bottom:20px; }
select, input, button { padding:10px; margin:5px 0; border-radius:8px; border:none; font-family:'Comfortaa',sans-serif; font-size:14px; }
input, select { width:200px; background:#222; color:#fff; }
button { background:#ffbb00; color:#000; cursor:pointer; font-weight:700; }
button:hover { background:#cc8800; }
table { width:100%; border-collapse:collapse; margin-top:20px; }
thead th { background:#222; padding:10px; text-align:center; }
tbody td { padding:8px; text-align:center; border-top:1px solid #333; }
</style>
</head>
<body>

<h1>Registro de Horas Voluntários</h1>

<div>
  <label for="voluntario">Selecione o Voluntário:</label>
  <select id="voluntario">
    <option value="">-- Escolha --</option>
    <option value="Neto">Neto</option>
    <option value="Castro">Castro</option>
    <option value="Vinicius">Vinicius</option>
    <option value="Eni">Eni</option>
    <option value="Dan">Dan</option>
    <option value="Santis">Santis</option>
    <option value="Natalie">Natalie</option>
  </select>
</div>

<div style="margin-top:10px;">
  <input type="date" id="data" placeholder="Data">
  <input type="number" id="horas" placeholder="Horas" min="0">
  <input type="text" id="obs" placeholder="Observação">
  <button id="btnAdicionar">Adicionar Horas</button>
</div>

<table>
  <thead>
    <tr>
      <th>Data</th>
      <th>Horas</th>
      <th>Observação</th>
    </tr>
  </thead>
  <tbody id="tabela"></tbody>
</table>

<script>
const SHEET_URL = 'https://script.google.com/macros/s/AKfycbxSVuQf_P5HKQ4I3_fY-09dymivqxDkWLoBu_K3mmA/exec';

const voluntarioSelect = document.getElementById('voluntario');
const tabela = document.getElementById('tabela');
const btnAdicionar = document.getElementById('btnAdicionar');

function getNomeDaQuery() {
  const params = new URLSearchParams(window.location.search);
  return params.get('nome');
}

async function carregarDados(nome){
  if(!nome) { tabela.innerHTML=''; return; }
  try {
    const res = await fetch(`${SHEET_URL}?nome=${encodeURIComponent(nome)}`);
    const data = await res.json();
    if(data.error){ tabela.innerHTML=`<tr><td colspan="3">${data.error}</td></tr>`; return; }
    tabela.innerHTML='';
    data.forEach(row=>{
      const tr = document.createElement('tr');
      tr.innerHTML=`<td>${row.data}</td><td>${row.horas}</td><td>${row.observacao}</td>`;
      tabela.appendChild(tr);
    });
  } catch(err){
    tabela.innerHTML=`<tr><td colspan="3">Erro ao carregar dados</td></tr>`;
    console.error(err);
  }
}

// Atualiza a tabela a cada 10 segundos
let intervalo;
function iniciarAtualizacao(nome){
  carregarDados(nome);
  if(intervalo) clearInterval(intervalo);
  intervalo = setInterval(()=> carregarDados(nome), 10000);
}

// Seleção manual
voluntarioSelect.addEventListener('change', ()=>{
  const nome = voluntarioSelect.value;
  if(nome) iniciarAtualizacao(nome);
});

// Adicionar horas
btnAdicionar.addEventListener('click', async ()=>{
  const nome = voluntarioSelect.value;
  const data = document.getElementById('data').value;
  const horas = Number(document.getElementById('horas').value);
  const obs = document.getElementById('obs').value;

  if(!nome || !data || horas <= 0){ alert('Preencha todos os campos corretamente!'); return; }

  try{
    const res = await fetch(SHEET_URL, {
      method:'POST',
      body: JSON.stringify({nome,data,horas,observacao:obs}),
      headers:{'Content-Type':'application/json'}
    });
    const result = await res.json();
    if(result.success){
      alert('Horas registradas com sucesso!');
      document.getElementById('data').value='';
      document.getElementById('horas').value='';
      document.getElementById('obs').value='';
      carregarDados(nome);
    } else {
      alert('Erro ao registrar: '+(result.error||''));
    }
  } catch(err){
    console.error(err);
    alert('Erro ao enviar os dados.');
  }
});

// Detecta voluntário via query string
window.onload = ()=>{
  const nomeQuery = getNomeDaQuery();
  if(nomeQuery){
    voluntarioSelect.value = nomeQuery;
    iniciarAtualizacao(nomeQuery);
  }
};
</script>

</body>
</html>
